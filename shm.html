<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المحفظة الاستثمارية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div id="app" class="p-4 md:p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div>
                        <h1 class="text-2xl md:text-4xl font-bold text-slate-800 mb-2">إدارة المحفظة الاستثمارية</h1>
                        <p class="text-slate-600 text-sm md:text-base">نظام احترافي لإدارة الاستثمارات - بورصة الكويت</p>
                    </div>
                    <button onclick="toggleForm()" class="w-full md:w-auto bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 transition-all shadow-md">
                        ➕ إضافة سهم جديد
                    </button>
                </div>

                <!-- Stats -->
                <div id="stats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <!-- Form -->
            <div id="stockForm" class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl md:text-2xl font-bold text-slate-800">إضافة سهم جديد</h2>
                    <button onclick="toggleForm()" class="text-slate-400 hover:text-slate-600 text-2xl">✕</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">رمز السهم *</label>
                        <input type="text" id="symbol" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ZAIN">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">اسم الشركة</label>
                        <input type="text" id="company" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="شركة زين">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">القطاع</label>
                        <input type="text" id="sector" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="اتصالات">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">السعر الحالي (فلس) *</label>
                        <input type="number" step="0.001" id="currentPrice" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">سعر الشراء (فلس) *</label>
                        <input type="number" step="0.001" id="purchasePrice" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">عدد الأسهم *</label>
                        <input type="number" id="shares" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">الهدف الأول (فلس) *</label>
                        <input type="number" step="0.001" id="target1" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">الهدف الثاني (فلس) *</label>
                        <input type="number" step="0.001" id="target2" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">وقف الخسارة (فلس) *</label>
                        <input type="number" step="0.001" id="stopLoss" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">منطقة دخول 1</label>
                        <input type="number" step="0.001" id="entryZone1" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">منطقة دخول 2</label>
                        <input type="number" step="0.001" id="entryZone2" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">استراتيجية الاستثمار</label>
                        <select id="strategy" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="investment">استثمار طويل الأجل</option>
                            <option value="swing">تداول قصير الأجل</option>
                            <option value="speculation">مضاربة</option>
                        </select>
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-slate-700 mb-2">ملاحظات</label>
                        <textarea id="notes" rows="3" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="أضف أي ملاحظات مهمة..."></textarea>
                    </div>
                    <div class="md:col-span-3 flex gap-3">
                        <button onclick="addStock()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all">
                            💾 حفظ
                        </button>
                        <button onclick="toggleForm()" class="bg-slate-200 text-slate-700 px-8 py-3 rounded-lg font-semibold hover:bg-slate-300 transition-all">
                            إلغاء
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stocks List -->
            <div id="stocksList" class="space-y-4">
                <!-- Will be populated by JS -->
            </div>
        </div>
    </div>

    <script>
        const PORTFOLIO_VALUE = 1000000;
        let stocks = JSON.parse(localStorage.getItem('stocks')) || [];

        function toggleForm() {
            const form = document.getElementById('stockForm');
            form.classList.toggle('hidden');
            if (!form.classList.contains('hidden')) {
                clearForm();
            }
        }

        function clearForm() {
            document.getElementById('symbol').value = '';
            document.getElementById('company').value = '';
            document.getElementById('sector').value = '';
            document.getElementById('currentPrice').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('shares').value = '';
            document.getElementById('target1').value = '';
            document.getElementById('target2').value = '';
            document.getElementById('stopLoss').value = '';
            document.getElementById('entryZone1').value = '';
            document.getElementById('entryZone2').value = '';
            document.getElementById('strategy').value = 'investment';
            document.getElementById('notes').value = '';
        }

        function addStock() {
            const symbol = document.getElementById('symbol').value;
            const company = document.getElementById('company').value;
            const sector = document.getElementById('sector').value;
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
            const shares = parseInt(document.getElementById('shares').value);
            const target1 = parseFloat(document.getElementById('target1').value);
            const target2 = parseFloat(document.getElementById('target2').value);
            const stopLoss = parseFloat(document.getElementById('stopLoss').value);
            const entryZone1 = parseFloat(document.getElementById('entryZone1').value) || 0;
            const entryZone2 = parseFloat(document.getElementById('entryZone2').value) || 0;
            const strategy = document.getElementById('strategy').value;
            const notes = document.getElementById('notes').value;

            if (!symbol || !currentPrice || !purchasePrice || !shares || !target1 || !target2 || !stopLoss) {
                alert('الرجاء ملء جميع الحقول المطلوبة (*)');
                return;
            }

            const stock = {
                id: Date.now(),
                symbol, company, sector, currentPrice, purchasePrice, shares,
                target1, target2, stopLoss, entryZone1, entryZone2, strategy, notes
            };

            stocks.push(stock);
            localStorage.setItem('stocks', JSON.stringify(stocks));
            toggleForm();
            renderStocks();
            updateStats();
        }

        function deleteStock(id) {
            if (confirm('هل أنت متأكد من حذف هذا السهم؟')) {
                stocks = stocks.filter(s => s.id !== id);
                localStorage.setItem('stocks', JSON.stringify(stocks));
                renderStocks();
                updateStats();
            }
        }

        function calculateMetrics(stock) {
            const invested = stock.purchasePrice * stock.shares;
            const currentValue = stock.currentPrice * stock.shares;
            const pnl = currentValue - invested;
            const pnlPercent = ((pnl / invested) * 100).toFixed(2);
            const target1Percent = (((stock.target1 - stock.currentPrice) / stock.currentPrice) * 100).toFixed(2);
            const target2Percent = (((stock.target2 - stock.currentPrice) / stock.currentPrice) * 100).toFixed(2);
            const riskPercent = (((stock.currentPrice - stock.stopLoss) / stock.currentPrice) * 100).toFixed(2);
            const positionSize = ((invested / PORTFOLIO_VALUE) * 100).toFixed(2);
            
            return { invested, currentValue, pnl, pnlPercent, target1Percent, target2Percent, riskPercent, positionSize };
        }

        function getStrategyLabel(strategy) {
            const labels = {
                investment: 'استثمار طويل الأجل',
                swing: 'تداول قصير الأجل',
                speculation: 'مضاربة'
            };
            return labels[strategy];
        }

        function getStrategyColor(strategy) {
            const colors = {
                investment: 'bg-blue-100 text-blue-800',
                swing: 'bg-purple-100 text-purple-800',
                speculation: 'bg-orange-100 text-orange-800'
            };
            return colors[strategy];
        }

        function renderStocks() {
            const container = document.getElementById('stocksList');
            
            if (stocks.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-lg p-12 text-center">
                        <div class="text-slate-400 mb-4 text-6xl">📈</div>
                        <h3 class="text-xl font-semibold text-slate-700 mb-2">لا توجد أسهم في المحفظة</h3>
                        <p class="text-slate-500">ابدأ بإضافة أول سهم لمحفظتك الاستثمارية</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = stocks.map(stock => {
                const metrics = calculateMetrics(stock);
                const isProfit = metrics.pnl >= 0;
                
                return `
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            
                            <div class="lg:col-span-3">
                                <div class="flex items-start justify-between mb-3">
                                    <div>
                                        <h3 class="text-2xl font-bold text-slate-800">${stock.symbol}</h3>
                                        <p class="text-slate-600">${stock.company || ''}</p>
                                        ${stock.sector ? `<span class="inline-block mt-2 px-3 py-1 bg-slate-100 text-slate-700 text-xs rounded-full">${stock.sector}</span>` : ''}
                                    </div>
                                    <button onclick="deleteStock(${stock.id})" class="text-red-600 hover:text-red-800">🗑️</button>
                                </div>
                                <div class="space-y-2">
                                    <span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${getStrategyColor(stock.strategy)}">
                                        ${getStrategyLabel(stock.strategy)}
                                    </span>
                                    <div class="text-sm text-slate-600">
                                        <p>عدد الأسهم: <span class="font-semibold text-slate-800">${stock.shares.toLocaleString()}</span></p>
                                        <p>حجم المركز: <span class="font-semibold text-slate-800">${metrics.positionSize}%</span></p>
                                    </div>
                                </div>
                            </div>

                            <div class="lg:col-span-3">
                                <div class="space-y-3">
                                    <div>
                                        <p class="text-sm text-slate-600">السعر الحالي</p>
                                        <p class="text-2xl font-bold text-slate-800">${stock.currentPrice.toFixed(3)} فلس</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-slate-600">سعر الشراء</p>
                                        <p class="text-lg font-semibold text-slate-700">${stock.purchasePrice.toFixed(3)} فلس</p>
                                    </div>
                                    <div class="p-3 rounded-lg ${isProfit ? 'bg-green-50' : 'bg-red-50'}">
                                        <p class="text-sm ${isProfit ? 'text-green-700' : 'text-red-700'}">الربح/الخسارة</p>
                                        <p class="text-xl font-bold ${isProfit ? 'text-green-800' : 'text-red-800'}">
                                            ${isProfit ? '+' : ''}${metrics.pnl.toLocaleString()} د.ك
                                        </p>
                                        <p class="text-sm ${isProfit ? 'text-green-700' : 'text-red-700'}">
                                            ${isProfit ? '+' : ''}${metrics.pnlPercent}%
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="lg:col-span-3">
                                <div class="space-y-3">
                                    <div class="bg-green-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span>🎯</span>
                                            <p class="text-sm font-medium text-green-700">الهدف الأول</p>
                                        </div>
                                        <p class="text-lg font-bold text-green-800">${stock.target1.toFixed(3)} فلس</p>
                                        <p class="text-sm text-green-600">+${metrics.target1Percent}%</p>
                                    </div>
                                    <div class="bg-emerald-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span>🎯</span>
                                            <p class="text-sm font-medium text-emerald-700">الهدف الثاني</p>
                                        </div>
                                        <p class="text-lg font-bold text-emerald-800">${stock.target2.toFixed(3)} فلس</p>
                                        <p class="text-sm text-emerald-600">+${metrics.target2Percent}%</p>
                                    </div>
                                    <div class="bg-red-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span>⚠️</span>
                                            <p class="text-sm font-medium text-red-700">وقف الخسارة</p>
                                        </div>
                                        <p class="text-lg font-bold text-red-800">${stock.stopLoss.toFixed(3)} فلس</p>
                                        <p class="text-sm text-red-600">-${metrics.riskPercent}%</p>
                                    </div>
                                </div>
                            </div>

                            <div class="lg:col-span-3">
                                <div class="space-y-3">
                                    ${stock.entryZone1 > 0 ? `
                                        <div class="bg-blue-50 p-3 rounded-lg">
                                            <p class="text-sm font-medium text-blue-700 mb-1">منطقة دخول 1</p>
                                            <p class="text-lg font-bold text-blue-800">${stock.entryZone1.toFixed(3)} فلس</p>
                                            <p class="text-xs text-blue-600">فرصة للتعزيز</p>
                                        </div>
                                    ` : ''}
                                    ${stock.entryZone2 > 0 ? `
                                        <div class="bg-indigo-50 p-3 rounded-lg">
                                            <p class="text-sm font-medium text-indigo-700 mb-1">منطقة دخول 2</p>
                                            <p class="text-lg font-bold text-indigo-800">${stock.entryZone2.toFixed(3)} فلس</p>
                                            <p class="text-xs text-indigo-600">فرصة ثانية</p>
                                        </div>
                                    ` : ''}
                                    ${stock.notes ? `
                                        <div class="bg-amber-50 p-3 rounded-lg">
                                            <p class="text-sm font-medium text-amber-700 mb-1">ملاحظات</p>
                                            <p class="text-sm text-amber-800">${stock.notes}</p>
                                        </div>
                                    ` : ''}
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <p class="text-sm text-slate-600">القيمة الإجمالية</p>
                                        <p class="text-xl font-bold text-slate-800">${metrics.currentValue.toLocaleString()} د.ك</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const totalInvested = stocks.reduce((sum, stock) => sum + (stock.purchasePrice * stock.shares), 0);
            const totalCurrentValue = stocks.reduce((sum, stock) => sum + (stock.currentPrice * stock.shares), 0);
            const totalPnL = totalCurrentValue - totalInvested;
            const totalPnLPercent = totalInvested > 0 ? ((totalPnL / totalInvested) * 100).toFixed(2) : '0.00';
            const cashAvailable = PORTFOLIO_VALUE - totalInvested;

            document.getElementById('stats').innerHTML = `
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl">
                    <p class="text-sm text-blue-700 font-medium mb-1">إجمالي المحفظة</p>
                    <p class="text-xl md:text-2xl font-bold text-blue-900">${PORTFOLIO_VALUE.toLocaleString()} د.ك</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl">
                    <p class="text-sm text-green-700 font-medium mb-1">القيمة الحالية</p>
                    <p class="text-xl md:text-2xl font-bold text-green-900">${totalCurrentValue.toLocaleString()} د.ك</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl">
                    <p class="text-sm text-purple-700 font-medium mb-1">المبلغ المستثمر</p>
                    <p class="text-xl md:text-2xl font-bold text-purple-900">${totalInvested.toLocaleString()} د.ك</p>
                </div>
                <div class="bg-gradient-to-br ${totalPnL >= 0 ? 'from-emerald-50 to-emerald-100' : 'from-red-50 to-red-100'} p-4 rounded-xl">
                    <p class="text-sm font-medium mb-1 ${totalPnL >= 0 ? 'text-emerald-700' : 'text-red-700'}">الربح/الخسارة</p>
                    <p class="text-xl md:text-2xl font-bold ${totalPnL >= 0 ? 'text-emerald-900' : 'text-red-900'}">
                        ${totalPnL >= 0 ? '+' : ''}${totalPnL.toLocaleString()} د.ك
                    </p>
                    <p class="text-sm ${totalPnL >= 0 ? 'text-emerald-700' : 'text-red-700'}">
                        ${totalPnL >= 0 ? '+' : ''}${totalPnLPercent}%
                    </p>
                </div>
                <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-xl">
                    <p class="text-sm text-amber-700 font-medium mb-1">السيولة المتاحة</p>
                    <p class="text-xl md:text-2xl font-bold text-amber-900">${cashAvailable.toLocaleString()} د.ك</p>
                    <p class="text-sm text-amber-700">${((cashAvailable/PORTFOLIO_VALUE)*100).toFixed(1)}%</p>
                </div>
            `;
        }

        // Initialize
        renderStocks();
        updateStats();
    </script>
</body>
</html>
